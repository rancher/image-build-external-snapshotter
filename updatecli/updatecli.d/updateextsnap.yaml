---
name: "Update external-snapshotter version" 

sources:
 ext-snap:
   name: Get external-snapshotter version
   kind: githubrelease
   spec:
     owner: kubernetes-csi
     repository: external-snapshotter
     token: '{{ requiredEnv .github.token }}'
     typefilter:
       release: true
       draft: false
       prerelease: false
     versionfilter:
       kind: semver

targets:
  makefile:
    name: "Bump to latest external-snapshotter version in Makefile"
    kind: file
    scmid: default
    disablesourceinput: true
    spec:
      file: Makefile
      matchpattern: '(?m)^TAG \:\= (.*)'
      replacepattern: 'TAG := {{ source "ext-snap" }}$$(BUILD_META)'

scms:
  default:
    kind: github
    spec:
      token: '{{ requiredEnv .github.token }}'
      username: '{{ .github.username }}'
      user: '{{ .github.username }}'
      email: '{{ .github.email }}'
      owner: '{{ .github.owner }}'
      repository: '{{ .github.repository }}'
      branch: '{{ .github.branch }}'
      
actions:
    default:
        title: 'Bump external-snapshotter version to {{ source "ext-snap" }}'
        kind: github/pullrequest
        spec:
            automerge: false
            labels:
                - chore
                - skip-changelog
                - status/auto-created 
        scmid: default
